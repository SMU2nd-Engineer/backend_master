<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="contentsMapper">

    <!-- Contents 조회 -->
<!--    <select id="getAllContents" resultType="com.culturemoa.cultureMoaProject.board.dto.ContentsDTO" >-->
<!--        SELECT CONT.IDX, CONT.USER_IDX, CONT.CATEGORY_IDX, CONT.TITLE, CONT.DIVISION,-->
<!--               CONT.CONTENT, CONT.SDATE-->
<!--        FROM CONTENTS_TBL CONT-->
<!--        LEFT OUTER JOIN USER_TBL USERT ON-->
<!--             CONT.USER_IDX = USERT.IDX-->
<!--    </select>-->

    <!-- CONTENTS_TBL의 content와 USER_TBL의 유저 정보 조인
    edate는 끝 날짜라 값이 있으면 안됨 그래서 null이어야 함 -->
    <select id="getContentInfos" resultType="com.culturemoa.cultureMoaProject.board.dto.ContentInfoDTO" >
        SELECT CONT.IDX, CONT.USER_IDX, CONT.CATEGORY_IDX, CONT.TITLE, CONT.DIVISION,
        CONT.CONTENT, CONT.SDATE,
        USERT.NICKNAME
        FROM CONTENTS_TBL CONT
        LEFT OUTER JOIN USER_TBL USERT ON
        CONT.USER_IDX = USERT.IDX
        WHERE CONT.EDATE = NULL
    </select>

    <!-- CONTENTS_TBL의 검색어 조회 - search -->
    <select id="getContentSearch" resultType="com.culturemoa.cultureMoaProject.board.dto.ContentInfoDTO" >
        SELECT CONT.IDX, CONT.USER_IDX, CONT.CATEGORY_IDX, CONT.TITLE, CONT.DIVISION,
        CONT.CONTENT, CONT.SDATE,
        USERT.NICKNAME
        FROM CONTENTS_TBL CONT
        LEFT OUTER JOIN USER_TBL USERT ON
        CONT.USER_IDX = USERT.IDX
        <!--        WHERE CONT.EDATE = NULL -->
        <where>
            CONT.EDATE IS NULL
            <!-- Null 값이면 검색 조건 생략하고 빈문자 열인지 확인 -->
<!--            <if test="keyword != null and keyword != ''">-->
<!--                CAST(CONT.CATEGORY_IDX AS CHAR) LIKE CONCAT('%', #{keyword}, '%')-->
<!--                OR CONT.TITLE LIKE CONCAT('%', #{keyword}, '%'))-->
<!--            </if>-->
            <!-- category, title을 키워드로 검색 -->
<!--            <if test="keyword != null">-->
<!--                AND (category LIKE concat('%', #{keyword}, '%')-->
<!--                OR title LIKE concat('%', #{keyword}, '%'))-->
<!--            </if>-->
            <!-- category, title을 키워드로 검색 - 내가 짠 코드-->
<!--            <if test="category_idx != null">-->
<!--                AND (category_idx LIKE concat('%', #{keyword}, '%')-->
<!--                OR title LIKE concat('%', #{keyword}, '%'))-->
<!--            </if>-->

        </where>

    </select>

    <!-- CONTENTS_TBL의 게시글 등록 insert -->
<!--    <insert id="getContentInsert" useGeneratedKeys="true"-->
<!--            parameterType="com.culturemoa.cultureMoaProject.board.dto.ContentsDTO"-->
<!--            keyProperty="idx" >-->
<!--        INSERT INTO CONTENTS_TBL (USER_IDX, CATEGORY_IDX, TITLE, DIVISION, CONTENT, SDATE)-->
<!--        VALUES( #{user_idx}, #{category_idx}, #{title}, #{division}, #{content}, #{sdate});-->
<!--    </insert>-->

</mapper>