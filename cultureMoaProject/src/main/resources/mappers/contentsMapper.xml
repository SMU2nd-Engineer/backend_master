<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="contentsMapper">

    <!-- Contents 조회 -->
<!--    <select id="getAllContents" resultType="com.culturemoa.cultureMoaProject.board.dto.ContentsDTO" >-->
<!--        SELECT CONT.IDX, CONT.USER_IDX, CONT.CATEGORY_IDX, CONT.TITLE, CONT.DIVISION,-->
<!--               CONT.CONTENT, CONT.SDATE-->
<!--        FROM CONTENTS_TBL CONT-->
<!--        LEFT OUTER JOIN USER_TBL USERT ON-->
<!--             CONT.USER_IDX = USERT.IDX-->
<!--    </select>-->

    <!-- CONTENTS_TBL의 content와 USER_TBL의 유저 정보 조인
    edate는 끝 날짜라 값이 있으면 안됨 그래서 null이어야 함 -->
    <select id="getContentInfos" resultType="com.culturemoa.cultureMoaProject.board.dto.ContentInfoDTO" >
        SELECT CONT.IDX, CONT.USER_IDX, CONT.CATEGORY_IDX, CONT.TITLE, CONT.DIVISION,
        CONT.CONTENT, CONT.SDATE,
        USERT.NICKNAME
        FROM CONTENTS_TBL CONT
        LEFT OUTER JOIN USER_TBL USERT ON
        CONT.USER_IDX = USERT.IDX
        WHERE CONT.EDATE is NULL
    </select>

    <!-- CONTENTS_TBL의 검색어 조회 - search -->
    <select id="getContentSearchs" resultType="com.culturemoa.cultureMoaProject.board.dto.ContentInfoDTO" >
        SELECT CONT.IDX, CONT.USER_IDX, CONT.CATEGORY_IDX, CONT.TITLE, CONT.DIVISION,
        CONT.CONTENT, CONT.SDATE,
        USERT.NICKNAME
        FROM CONTENTS_TBL CONT
        LEFT OUTER JOIN USER_TBL USERT ON
        CONT.USER_IDX = USERT.IDX

        <where>
            <!-- edate: 종료일/삭제일로 삭제되지 않았거나, 아직 유효한 게시글만 보여주는 필터 조건이고,
                DB에서 삭제하지 않고 EDATE에 날짜만 남기는 방식임 -->
            CONT.EDATE IS NULL

            <!-- '팝니다', '삽니다' 선택한 필터 category_idx(일단 숫자로 해놓고 나중에 바꿔야함 프론트엔드에서도) -->
            <if test="division != division and division != ''">
                <!-- Contents_tbl의 division -->
                AND CONT.DIVISION = #{division}
            </if>
            <!-- 제목+내용 구분값이 달라서 if문을 구분해서 작성해야함 (일단 숫자로 해놓고 나중에 바꿔야함 프론트엔드에서도) -->
            <if test="searchType==0">
                <!-- Contents_tbl의 title(제목), content(내용)
                  눈에 안보이는것 까지 검색(게시판에 없는 칼럼 : content(내용) -->
                AND (
                    CONT.TITLE LIKE '%${keyword}%'
                    OR CONT.CONTENT LIKE '%${keyword}%'
                )
            </if>
            <!-- 새로생성(프론트엔드+DTO생성) - searchType: 제목+내용/작성자(nickname) 의 구분값
                 USER_tbl의 nickname을 키워드로 검색 -->
            <if test="searchType==1">
               AND USERT.NICKNAME LIKE '%${keyword}%'
            </if>
        </where>

    </select>

    <!-- CONTENTS_TBL의 게시글 등록 insert -->
<!--    <insert id="getContentInsert" useGeneratedKeys="true"-->
<!--            parameterType="com.culturemoa.cultureMoaProject.board.dto.ContentsDTO"-->
<!--            keyProperty="idx" >-->
<!--        INSERT INTO CONTENTS_TBL (USER_IDX, CATEGORY_IDX, TITLE, DIVISION, CONTENT, SDATE)-->
<!--        VALUES( #{user_idx}, #{category_idx}, #{title}, #{division}, #{content}, #{sdate});-->
<!--    </insert>-->

</mapper>